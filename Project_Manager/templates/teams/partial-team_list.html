{% load static custom_filters %}

{% if teams %}
    {% for team in teams %}
        <div id="card_{{team.id}}" class="shadow-lg relative self-start card w-[22rem] border border-solid border-gray-200 rounded-2xl mx-4 p-4 mb-6 transition-all duration-500 col-span-12  xl:p-6  lg:col-span-3 md:col-span-6 ">
            <div class="relative mb-6">
                {% if team.image %}
                    <img class="w-14 h-14 rounded-xl" src="{{ team.image.url }}" alt="">
                {% else %}
                    <div class="w-14 h-14 bg-{{ team.color }}-400 rounded-xl flex items-center justify-center font-bold text-white">
                        {{ team.short_name }}
                    </div>
                {% endif %}

                <div class="dropdown dropdown-end absolute top-0 right-0 w-[30px] h-auto rounded-md hover:bg-gray-300">
                    <!-- Кнопка с иконкой (без фона) -->
                    <div tabindex="0" role="button" class="pointer bg-transparent border-none hover:bg-transparent">
                        <img 
                            class="w-[30px] h-auto" 
                            src="{% static 'teams/img/ellipsis.png' %}" 
                            alt="Menu"
                        >`
                    </div>
                    
                    {% if team.author == request.user %}
                    <!-- Выпадающее меню -->
                    <ul tabindex="0" class="dropdown-content menu bg-gray-100 border border-gray-400 shadow-md rounded-lg z-10 w-52 p-2">
                        <li><a class="rounded text-gray-600 hover:bg-gray-200"  onclick="document.getElementById('update_team_modal_{{ team.id }}').showModal()">Редактировать</a></li>
                        <li><a class="rounded text-red-500 hover:bg-red-500 hover:text-white" hx-post="{% url 'teams:delete_team' team.id %}" hx-target="#card_{{team.id}}" hx-swap="delete">Удалить</a></li>
                        {% with form=team_forms|dictkey:team.id %}
                            {% include 'includes/update-team-modal.html' %}
                        {% endwith %}
                    </ul>
                    {% else %}
                    <ul tabindex="0" class="dropdown-content menu bg-gray-100 border border-gray-400 shadow-md rounded-lg z-10 w-52 p-2">
                        <li><a class="rounded text-red-500 hover:bg-red-500 hover:text-white" hx-post="{% url 'teams:leave_from_team' team.id %}" hx-target="#card_{{team.id}}" hx-swap="delete">Покинуть команду</a></li>
                    </ul>
                    {% endif %}
                </div>

            </div>
            <div class="h-[100px]">
                <h4 class="text-base font-semibold text-gray-900 mb-2 capitalize transition-all duration-500 ">{{ team.name }}</h4>
            </div>
            <a href="{% url 'teams:projects:project_list' team.id %}" class="px-5 py-2 text-xs font-semibold text-white text-center bg-indigo-600 rounded-full shadow-sm">Перейти</a>
            
            <!-- Footer -->
            <div class="mt-[15px] flex cursor-pointer group relative max-w-max">
                <img class="w-[1.25rem] h-[1.30rem] mr-1.5 self-center grayscale-[100%] brightness-75" src="{% static 'teams/img/calendar.png' %}">
                <p class="text-zinc-500">{{ team.created_at|date:"d.m.Y" }}</p>
                <!-- Кастомный тултип -->
                <span class="absolute -top-10 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs text-center py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none">
                    Создано: {{ team.created_at|date:"d.m.Y" }} <br>
                    {{ team.author }}
                </span>
            </div>
                        
        </div>
    {% endfor %}

{% else %}

<div role="alert" class="alert alert-info bg-sky-400">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="h-6 w-6 shrink-0 stroke-current">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <span>Команды не найдены, <a class="underline text-white font-semibold hover:text-rose-500 transition-colors duration-200 cursor-pointer" onclick="team_modal.showModal();">
        создайте</a> свою или присоеденитесь к существующей</span>
</div>

<script>
    const team_modal = document.querySelector('#add_team_modal');
</script>
{% endif %}